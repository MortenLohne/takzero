// <![CDATA[
(()=>{"use strict";
const popupWidth = 250,
  popupHeight = 200,
  popupHideDelay = 300,
  pngOptions = { imageSize: "md", theme: "discord", stackCounts: true };
var __webpack_modules__={241:(e,t,r)=>{r.d(t,{A:()=>a});const a=r(917).A.Symbol},383:(e,t,r)=>{r.d(t,{A:()=>p});var a=r(241),o=Object.prototype,i=o.hasOwnProperty,s=o.toString,n=a.A?a.A.toStringTag:void 0;var l=Object.prototype.toString;var c=a.A?a.A.toStringTag:void 0;const p=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":c&&c in Object(e)?function(e){var t=i.call(e,n),r=e[n];try{e[n]=void 0;var a=!0}catch(e){}var o=s.call(e);return a&&(t?e[n]=r:delete e[n]),o}(e):function(e){return l.call(e)}(e)}},136:(e,t,r)=>{r.d(t,{A:()=>a});const a="object"==typeof global&&global&&global.Object===Object&&global},917:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(136),o="object"==typeof self&&self&&self.Object===Object&&self;const i=a.A||o||Function("return this")()},49:(e,t,r)=>{r.d(t,{A:()=>a});const a=Array.isArray},916:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(383),o=r(98);const i=function(e){return!0===e||!1===e||(0,o.A)(e)&&"[object Boolean]"==(0,a.A)(e)}},879:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(383),o=r(98);const i=function(e){return"number"==typeof e||(0,o.A)(e)&&"[object Number]"==(0,a.A)(e)}},98:(e,t,r)=>{r.d(t,{A:()=>a});const a=function(e){return null!=e&&"object"==typeof e}},703:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(383),o=r(49),i=r(98);const s=function(e){return"string"==typeof e||!(0,o.A)(e)&&(0,i.A)(e)&&"[object String]"==(0,a.A)(e)}},666:(e,t,r)=>{r.d(t,{A:()=>a});const a=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},246:(e,t,r)=>{r.d(t,{bW:()=>ar});var a=r(54);const o=class{constructor(e){this.index=e.index,this.color=e.color,this.type=e.type,this.square=null,this.isStanding=!1,this.isCapstone=!1,this.setType(this.type)}typeCode(){return this.isCapstone?"C":this.isStanding?"S":""}type(){return this.isCapstone?"cap":"flat"}setType(e){this.isStanding=/S|wall/.test(e),this.isCapstone=/C|cap/.test(e)}x(){return this.square?this.square.x:null}y(){return this.square?this.square.y:null}z(){return this.square?this.square.pieces.indexOf(this):null}isFlat(){return!(this.isCapstone||this.isStanding)}};var i=r(682),s=Object.prototype;const n=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||s)},l=function(e,t){return function(r){return e(t(r))}},c=l(Object.keys,Object);var p=Object.prototype.hasOwnProperty;const d=function(e){if(!n(e))return c(e);var t=[];for(var r in Object(e))p.call(e,r)&&"constructor"!=r&&t.push(r);return t};var f=r(383);const h=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},u=function(e){if(!h(e))return!1;var t=(0,f.A)(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};var y=r(917);const b=y.A["__core-js_shared__"];var _,g=(_=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var m=Function.prototype.toString;const v=function(e){if(null!=e){try{return m.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var k=/^\[object .+?Constructor\]$/,w=Function.prototype,D=Object.prototype,x=w.toString,A=D.hasOwnProperty,E=RegExp("^"+x.call(A).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const S=function(e){return!(!h(e)||(t=e,g&&g in t))&&(u(e)?E:k).test(v(e));var t},j=function(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return S(r)?r:void 0},O=j(y.A,"DataView"),P=j(y.A,"Map"),C=j(y.A,"Promise"),M=j(y.A,"Set"),I=j(y.A,"WeakMap");var T="[object Map]",q="[object Promise]",N="[object Set]",z="[object WeakMap]",B="[object DataView]",L=v(O),R=v(P),W=v(C),U=v(M),$=v(I),F=f.A;(O&&F(new O(new ArrayBuffer(1)))!=B||P&&F(new P)!=T||C&&F(C.resolve())!=q||M&&F(new M)!=N||I&&F(new I)!=z)&&(F=function(e){var t=(0,f.A)(e),r="[object Object]"==t?e.constructor:void 0,a=r?v(r):"";if(a)switch(a){case L:return B;case R:return T;case W:return q;case U:return N;case $:return z}return t});const K=F;var G=r(98);const Y=function(e){return(0,G.A)(e)&&"[object Arguments]"==(0,f.A)(e)};var V=Object.prototype,X=V.hasOwnProperty,H=V.propertyIsEnumerable;const Q=Y(function(){return arguments}())?Y:function(e){return(0,G.A)(e)&&X.call(e,"callee")&&!H.call(e,"callee")};var J=r(49);const Z=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},ee=function(e){return null!=e&&Z(e.length)&&!u(e)};var te="object"==typeof exports&&exports&&!exports.nodeType&&exports,re=te&&"object"==typeof module&&module&&!module.nodeType&&module,ae=re&&re.exports===te?y.A.Buffer:void 0;const oe=(ae?ae.isBuffer:void 0)||function(){return!1};var ie={};ie["[object Float32Array]"]=ie["[object Float64Array]"]=ie["[object Int8Array]"]=ie["[object Int16Array]"]=ie["[object Int32Array]"]=ie["[object Uint8Array]"]=ie["[object Uint8ClampedArray]"]=ie["[object Uint16Array]"]=ie["[object Uint32Array]"]=!0,ie["[object Arguments]"]=ie["[object Array]"]=ie["[object ArrayBuffer]"]=ie["[object Boolean]"]=ie["[object DataView]"]=ie["[object Date]"]=ie["[object Error]"]=ie["[object Function]"]=ie["[object Map]"]=ie["[object Number]"]=ie["[object Object]"]=ie["[object RegExp]"]=ie["[object Set]"]=ie["[object String]"]=ie["[object WeakMap]"]=!1;const se=function(e){return function(t){return e(t)}};var ne=r(136),le="object"==typeof exports&&exports&&!exports.nodeType&&exports,ce=le&&"object"==typeof module&&module&&!module.nodeType&&module,pe=ce&&ce.exports===le&&ne.A.process;const de=function(){try{return ce&&ce.require&&ce.require("util").types||pe&&pe.binding&&pe.binding("util")}catch(e){}}();var fe=de&&de.isTypedArray;const he=fe?se(fe):function(e){return(0,G.A)(e)&&Z(e.length)&&!!ie[(0,f.A)(e)]};var ue=Object.prototype.hasOwnProperty;const ye=function(e){if(null==e)return!0;if(ee(e)&&((0,J.A)(e)||"string"==typeof e||"function"==typeof e.splice||oe(e)||he(e)||Q(e)))return!e.length;var t=K(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(n(e))return!d(e).length;for(var r in e)if(ue.call(e,r))return!1;return!0},be=function(e,t){return e===t||e!=e&&t!=t},_e=function(e,t){for(var r=e.length;r--;)if(be(e[r][0],t))return r;return-1};var ge=Array.prototype.splice;function me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}me.prototype.clear=function(){this.__data__=[],this.size=0},me.prototype.delete=function(e){var t=this.__data__,r=_e(t,e);return!(r<0||(r==t.length-1?t.pop():ge.call(t,r,1),--this.size,0))},me.prototype.get=function(e){var t=this.__data__,r=_e(t,e);return r<0?void 0:t[r][1]},me.prototype.has=function(e){return _e(this.__data__,e)>-1},me.prototype.set=function(e,t){var r=this.__data__,a=_e(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this};const ve=me,ke=j(Object,"create");var we=Object.prototype.hasOwnProperty;var De=Object.prototype.hasOwnProperty;function xe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}xe.prototype.clear=function(){this.__data__=ke?ke(null):{},this.size=0},xe.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},xe.prototype.get=function(e){var t=this.__data__;if(ke){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return we.call(t,e)?t[e]:void 0},xe.prototype.has=function(e){var t=this.__data__;return ke?void 0!==t[e]:De.call(t,e)},xe.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ke&&void 0===t?"__lodash_hash_undefined__":t,this};const Ae=xe,Ee=function(e,t){var r,a,o=e.__data__;return("string"==(a=typeof(r=t))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map};function Se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}Se.prototype.clear=function(){this.size=0,this.__data__={hash:new Ae,map:new(P||ve),string:new Ae}},Se.prototype.delete=function(e){var t=Ee(this,e).delete(e);return this.size-=t?1:0,t},Se.prototype.get=function(e){return Ee(this,e).get(e)},Se.prototype.has=function(e){return Ee(this,e).has(e)},Se.prototype.set=function(e,t){var r=Ee(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this};const je=Se;function Oe(e){var t=this.__data__=new ve(e);this.size=t.size}Oe.prototype.clear=function(){this.__data__=new ve,this.size=0},Oe.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Oe.prototype.get=function(e){return this.__data__.get(e)},Oe.prototype.has=function(e){return this.__data__.has(e)},Oe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ve){var a=r.__data__;if(!P||a.length<199)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new je(a)}return r.set(e,t),this.size=r.size,this};const Pe=Oe,Ce=function(){try{var e=j(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Me=function(e,t,r){"__proto__"==t&&Ce?Ce(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Ie=Object.prototype.hasOwnProperty;const Te=function(e,t,r){var a=e[t];Ie.call(e,t)&&be(a,r)&&(void 0!==r||t in e)||Me(e,t,r)},qe=function(e,t,r,a){var o=!r;r||(r={});for(var i=-1,s=t.length;++i<s;){var n=t[i],l=a?a(r[n],e[n],n,r,e):void 0;void 0===l&&(l=e[n]),o?Me(r,n,l):Te(r,n,l)}return r},Ne=function(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a};var ze=/^(?:0|[1-9]\d*)$/;const Be=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&ze.test(e))&&e>-1&&e%1==0&&e<t};var Le=Object.prototype.hasOwnProperty;const Re=function(e,t){var r=(0,J.A)(e),a=!r&&Q(e),o=!r&&!a&&oe(e),i=!r&&!a&&!o&&he(e),s=r||a||o||i,n=s?Ne(e.length,String):[],l=n.length;for(var c in e)!t&&!Le.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Be(c,l))||n.push(c);return n},We=function(e){return ee(e)?Re(e):d(e)};var Ue=Object.prototype.hasOwnProperty;const $e=function(e){if(!h(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=n(e),r=[];for(var a in e)("constructor"!=a||!t&&Ue.call(e,a))&&r.push(a);return r},Fe=function(e){return ee(e)?Re(e,!0):$e(e)};var Ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ge=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Ge&&Ge.exports===Ke?y.A.Buffer:void 0,Ve=Ye?Ye.allocUnsafe:void 0;const Xe=function(e,t){for(var r=-1,a=null==e?0:e.length,o=0,i=[];++r<a;){var s=e[r];t(s,r,e)&&(i[o++]=s)}return i},He=function(){return[]};var Qe=Object.prototype.propertyIsEnumerable,Je=Object.getOwnPropertySymbols;const Ze=Je?function(e){return null==e?[]:(e=Object(e),Xe(Je(e),(function(t){return Qe.call(e,t)})))}:He,et=function(e,t){for(var r=-1,a=t.length,o=e.length;++r<a;)e[o+r]=t[r];return e},tt=l(Object.getPrototypeOf,Object),rt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)et(t,Ze(e)),e=tt(e);return t}:He,at=function(e,t,r){var a=t(e);return(0,J.A)(e)?a:et(a,r(e))},ot=function(e){return at(e,We,Ze)},it=function(e){return at(e,Fe,rt)};var st=Object.prototype.hasOwnProperty;const nt=y.A.Uint8Array,lt=function(e){var t=new e.constructor(e.byteLength);return new nt(t).set(new nt(e)),t};var ct=/\w*$/;var pt=r(241),dt=pt.A?pt.A.prototype:void 0,ft=dt?dt.valueOf:void 0;const ht=function(e,t,r){var a,o,i,s=e.constructor;switch(t){case"[object ArrayBuffer]":return lt(e);case"[object Boolean]":case"[object Date]":return new s(+e);case"[object DataView]":return function(e,t){var r=t?lt(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?lt(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,r);case"[object Map]":case"[object Set]":return new s;case"[object Number]":case"[object String]":return new s(e);case"[object RegExp]":return(i=new(o=e).constructor(o.source,ct.exec(o))).lastIndex=o.lastIndex,i;case"[object Symbol]":return a=e,ft?Object(ft.call(a)):{}}};var ut=Object.create;const yt=function(){function e(){}return function(t){if(!h(t))return{};if(ut)return ut(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var bt=de&&de.isMap;const _t=bt?se(bt):function(e){return(0,G.A)(e)&&"[object Map]"==K(e)};var gt=de&&de.isSet;const mt=gt?se(gt):function(e){return(0,G.A)(e)&&"[object Set]"==K(e)};var vt="[object Arguments]",kt="[object Function]",wt="[object Object]",Dt={};Dt[vt]=Dt["[object Array]"]=Dt["[object ArrayBuffer]"]=Dt["[object DataView]"]=Dt["[object Boolean]"]=Dt["[object Date]"]=Dt["[object Float32Array]"]=Dt["[object Float64Array]"]=Dt["[object Int8Array]"]=Dt["[object Int16Array]"]=Dt["[object Int32Array]"]=Dt["[object Map]"]=Dt["[object Number]"]=Dt[wt]=Dt["[object RegExp]"]=Dt["[object Set]"]=Dt["[object String]"]=Dt["[object Symbol]"]=Dt["[object Uint8Array]"]=Dt["[object Uint8ClampedArray]"]=Dt["[object Uint16Array]"]=Dt["[object Uint32Array]"]=!0,Dt["[object Error]"]=Dt[kt]=Dt["[object WeakMap]"]=!1;const xt=function e(t,r,a,o,i,s){var l,c=1&r,p=2&r,d=4&r;if(a&&(l=i?a(t,o,i,s):a(t)),void 0!==l)return l;if(!h(t))return t;var f=(0,J.A)(t);if(f){if(l=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&st.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(t),!c)return function(e,t){var r=-1,a=e.length;for(t||(t=Array(a));++r<a;)t[r]=e[r];return t}(t,l)}else{var u=K(t),y=u==kt||"[object GeneratorFunction]"==u;if(oe(t))return function(e,t){if(t)return e.slice();var r=e.length,a=Ve?Ve(r):new e.constructor(r);return e.copy(a),a}(t,c);if(u==wt||u==vt||y&&!i){if(l=p||y?{}:function(e){return"function"!=typeof e.constructor||n(e)?{}:yt(tt(e))}(t),!c)return p?function(e,t){return qe(e,rt(e),t)}(t,function(e,t){return e&&qe(t,Fe(t),e)}(l,t)):function(e,t){return qe(e,Ze(e),t)}(t,function(e,t){return e&&qe(t,We(t),e)}(l,t))}else{if(!Dt[u])return i?t:{};l=ht(t,u,c)}}s||(s=new Pe);var b=s.get(t);if(b)return b;s.set(t,l),mt(t)?t.forEach((function(o){l.add(e(o,r,a,o,t,s))})):_t(t)&&t.forEach((function(o,i){l.set(i,e(o,r,a,i,t,s))}));var _=f?void 0:(d?p?it:ot:p?Fe:We)(t);return function(e,t){for(var r=-1,a=null==e?0:e.length;++r<a&&!1!==t(e[r],r,e););}(_||t,(function(o,i){_&&(o=t[i=o]),Te(l,i,e(o,r,a,i,t,s))})),l},At=function(e){return xt(e,5)},Et=function(e){for(var t=-1,r=null==e?0:e.length,a=0,o=[];++t<r;){var i=e[t];i&&(o[a++]=i)}return o};function St(e,t,r){const a={},o={};let i;const s=e.piece.color;return a[e.coord]=e,delete t[s][e.coord],e.isEdge&&e.edges.forEach((e=>o[e]=!0)),r[e.coord].forEach((e=>{e.coord in t[s]&&(i=St(e,t,r),Object.assign(a,i.squares),Object.assign(o,i.edges))})),{squares:a,edges:o}}function jt(e,t,r,a=""){const o=(o,i)=>{const s=o.isEdge&&!a||o["is"+a],n=[];r[o.coord].forEach((e=>{e.coord in t&&n.push(e)})),n.length<2&&(!s||n[0]&&n[0]["is"+a])?(delete t[o.coord],e[i]=n[0]):e[i]=void 0};for(e=e.concat();e.length;)e.forEach(o),e=Et(e)}function Ot(e,t,r){e[r].push({edges:t.edges,squares:Object.keys(t.squares)}),Object.assign(e.squares[r],t.squares),t.edges.NS&&(e.edges[r].NS=!0),t.edges.EW&&(e.edges[r].EW=!0)}var Pt=r(703);const Ct=function(e){return e};var Mt=Math.max;const It=Ce?function(e,t){return Ce(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:Ct;var Tt=Date.now;const qt=(Nt=It,zt=0,Bt=0,function(){var e=Tt(),t=16-(e-Bt);if(Bt=e,t>0){if(++zt>=800)return arguments[0]}else zt=0;return Nt.apply(void 0,arguments)});var Nt,zt,Bt;var Lt=Math.max;const Rt=function(e,t){return qt(function(e,t,r){return t=Mt(void 0===t?e.length-1:t,0),function(){for(var a=arguments,o=-1,i=Mt(a.length-t,0),s=Array(i);++o<i;)s[o]=a[t+o];o=-1;for(var n=Array(t+1);++o<t;)n[o]=a[o];return n[t]=r(s),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,n)}}(e,t,Ct),e+"")}((function(e){if(!e||!e.length)return[];var t=0;return e=Xe(e,(function(e){if(r=e,(0,G.A)(r)&&ee(r))return t=Lt(e.length,t),!0;var r})),Ne(t,(function(t){return function(e,t){for(var r=-1,a=null==e?0:e.length,o=Array(a);++r<a;)o[r]=t(e[r],r,e);return o}(e,(r=t,function(e){return null==e?void 0:e[r]}));var r}))}));var Wt=r(879);var Ut=/\s/;var $t=/^\s+/;const Ft=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Ut.test(e.charAt(t)););return t}(e)+1).replace($t,""):e};var Kt=/^[-+]0x[0-9a-f]+$/i,Gt=/^0b[01]+$/i,Yt=/^0o[0-7]+$/i,Vt=parseInt;const Xt=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||(0,G.A)(e)&&"[object Symbol]"==(0,f.A)(e)}(e))return NaN;if(h(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=h(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ft(e);var r=Gt.test(e);return r||Yt.test(e)?Vt(e.slice(2),r?2:8):Kt.test(e)?NaN:+e};var Ht=1/0;const Qt=function(e){var t=function(e){return e?(e=Xt(e))===Ht||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),r=t%1;return t==t?r?t-r:t:0};var Jt=4294967295,Zt=Math.min;const er=function(e,t){if((e=Qt(e))<1||e>9007199254740991)return[];var r,a=Jt,o=Zt(e,Jt);e-=Jt;for(var i=Ne(o,t="function"==typeof(r=t)?r:Ct);++a<e;)t(a);return i},tr={3:{flat:10,cap:0},4:{flat:15,cap:0},5:{flat:21,cap:1},6:{flat:30,cap:1},7:{flat:40,cap:2},8:{flat:50,cap:2}},rr=function(e){const t=e.toUpperCase().match(/^([X1-8SC,/-]+)\s+([12])\s+(\d+)$/),r={};if(!t)return r.error="Invalid TPS notation",r;[,r.grid,r.player,r.linenum]=t,r.grid=r.grid.replace(/X(\d+)/g,((e,t)=>{const r=["X"];for(;r.length<t;)r.push("X");return r.join(",")})).split(/[/-]/).reverse().map((e=>e.split(","))),r.size=r.grid.length,r.player=Number(r.player),r.linenum=Number(r.linenum);const a=/^(X|[12]+[SC]?)$/;return r.grid.find((e=>e.length!==r.size||e.find((e=>!a.test(e)))))&&(r.error="Invalid TPS notation"),r},ar=class{constructor(e={}){if(this.options={opening:"swap",...e},this.errors=[],(0,Pt.A)(e.tps)&&e.tps.length){const t=rr(e.tps);if(t.error)return void this.errors.push(t.error);e.transform&&(function(e,[t,r]){if((0,Pt.A)(e)&&(e=rr(e)).error)throw e.error;t%=4,r%=2;let a=At(e.grid);1===t?a=Rt(...a.map((e=>e.reverse()))):2===t?a=a.map((e=>e.reverse())).reverse():3===t&&(a=Rt(...a).map((e=>e.reverse()))),r&&(a=a.map((e=>e.reverse()))),e.grid=a}(t,e.transform),this.transform=e.transform),this.grid=t.grid,this.size=t.size,this.player=t.player,this.linenum=t.linenum}else{if(!(0,Wt.A)(e.size||e.tps))return void this.errors.push("Missing TPS or board size");this.size=e.size||e.tps,this.player=1,this.linenum=1}if(String(this.size)in tr){this.pieceCounts={1:{...tr[this.size]},2:{...tr[this.size]}},e.flats&&(this.pieceCounts[1].flat=Number(e.flats),this.pieceCounts[2].flat=Number(e.flats)),e.caps&&(this.pieceCounts[1].cap=Number(e.caps),this.pieceCounts[2].cap=Number(e.caps)),e.flats1&&(this.pieceCounts[1].flat=Number(e.flats1)),e.caps1&&(this.pieceCounts[1].cap=Number(e.caps1)),e.flats2&&(this.pieceCounts[2].flat=Number(e.flats2)),e.caps2&&(this.pieceCounts[2].cap=Number(e.caps2)),this.pieceCounts[1].total=this.pieceCounts[1].flat+this.pieceCounts[1].cap,this.pieceCounts[2].total=this.pieceCounts[2].flat+this.pieceCounts[2].cap,e.komi&&(this.komi=Number(e.komi),this.komi%1&&(this.komi=Math.floor(this.komi)+.5)),this.pieces={all:{1:{flat:[],cap:[]},2:{flat:[],cap:[]}},played:{1:{flat:[],cap:[]},2:{flat:[],cap:[]}}},[1,2].forEach((e=>{["flat","cap"].forEach((t=>{for(let r=0;r<this.pieceCounts[e][t];r++)this.pieces.all[e][t][r]=new o({index:r,color:e,type:t})}))})),this.squares=[];for(let e=0;e<this.size;e++){this.squares[e]=[];for(let t=0;t<this.size;t++)this.squares[e][t]=new a.M6(t,e,this.size)}if(this.squares.forEach((e=>{e.forEach((e=>{e.edges.N||(e.neighbors.N=this.squares[e.y+1][e.x]),e.edges.S||(e.neighbors.S=this.squares[e.y-1][e.x]),e.edges.E||(e.neighbors.E=this.squares[e.y][e.x+1]),e.edges.W||(e.neighbors.W=this.squares[e.y][e.x-1])}))})),this.grid){let e,t,r,a;this.grid.forEach(((o,i)=>{o.forEach(((o,s)=>{if("X"!==o[0])for(e=o.split(""),t=this.squares[i][s];r=e.shift();)a=/[SC]/.test(e[0])?e.shift():"flat",this.playPiece(r,a,t)}))}))}this.afterPly()}else this.errors.push("Invalid board size")}afterPly(){this.flats=[0,0],this.squares.forEach((e=>{e.forEach((e=>{e.color&&e.piece.isFlat()&&this.flats[e.color-1]++}))})),this.komi&&(this.flats[1*(this.komi>0)]+=Math.abs(this.komi)),this.isGameEnd=!1,this.result="";const e=function(e,t){const r=[1,2],a={1:{},2:{}},o={},i={1:[],2:[]},s=[],n={1:[],2:[],squares:{1:[],2:[]},edges:{1:{NS:!1,EW:!1},2:{NS:!1,EW:!1}},length:0};let l;return e.forEach((e=>e.forEach((e=>{const t=e.piece;if(t&&!t.isStanding){const r=t.color;o[e.coord]=e.connected.map((t=>e.neighbors[t])).filter((e=>e));const n=o[e.coord];1===n.length?e.isEdge?(a[r][e.coord]=e,i[r].push(e)):s.push(e):n.length>1&&(a[r][e.coord]=e,e.isEdge&&2===n.length&&n.find((e=>e.isEdge))&&n.find((e=>!e.isEdge))&&i[r].push(e))}else o[e.coord]=[]})))),r.forEach((e=>jt(s,a[e],o))),r.forEach((e=>{for(;!ye(a[e]);)if(l=St(a[e][Object.keys(a[e])[0]],a,o),l.edges.NS=l.edges.S&&l.edges.N||!1,l.edges.EW=l.edges.W&&l.edges.E||!1,l.edges.NS||l.edges.EW)if(l.edges.NS&&l.edges.EW){const t=At(l);l.edges.EW=!1,t.edges.NS=!1,jt(i[e],l.squares,o,"NS"),jt(i[e],t.squares,o,"EW"),Ot(n,l,e),Ot(n,t,e)}else jt(i[e],l.squares,o,l.edges.NS?"NS":"EW"),Ot(n,l,e);n.squares[e]=Object.keys(n.squares[e])||[],n.length+=n[e].length})),n}(this.squares);e.length?(this.roads=e,e[1].concat(e[2]).forEach((e=>{e.squares.forEach((t=>{t=(0,a.e0)(t),this.squares[t[1]][t[0]].setRoad(e)}))})),e[this.player].length?this.result=1===this.player?"R-0":"0-R":e[1===this.player?2:1].length&&(this.result=1===this.player?"0-R":"R-0"),this.result&&(this.isGameEnd=!0)):this.pieces.played[this.player].flat.length+this.pieces.played[this.player].cap.length!==this.pieceCounts[this.player].total&&this.squares.find((e=>e.find((e=>!e.pieces.length))))||(this.isGameEndFlats=!0,this.flats[0]===this.flats[1]?this.result="1/2-1/2":this.flats[0]>this.flats[1]?this.result="F-0":this.result="0-F",this.isGameEnd=!0)}getTPS(){return`${this.squares.map((e=>e.map((e=>e.pieces.length?e.pieces.map((e=>e.color+e.typeCode())).join(""):"x")).join(","))).reverse().join("/").replace(/x((,x)+)/g,(e=>"x"+(1+e.length)/2))} ${this.player} ${this.linenum}`}doPly(e){if(e instanceof i.Y||(e=new i.Y(e),this.transform&&(e=e.transform(this.size,this.transform))),this.isGameEnd)throw new Error("The game has ended");if(e.pieceCount>this.size)throw new Error("Ply violates carry limit");if(1===this.linenum&&(e.specialPiece||e.movement))throw new Error("Invalid first move");const t=[],r=e.toMoveset();if(r[0].errors)throw new Error(...r[0].errors);for(let a=0;a<r.length;a++){const o=r[a],i=o.action,s=o.x,n=o.y,l=o.count||1,c=o.type;if(!this.squares[n]||!this.squares[n][s])throw new Error("Invalid move");const p=this.squares[n][s];if(c)if("pop"===i)this.unplayPiece(p);else{if(p.piece)throw new Error("Invalid move");const t=this.playPiece("swap"===this.options.opening&&1===this.linenum?1===this.player?2:1:this.player,c,p);if(!t)throw new Error("Invalid move");t.ply=e}else if("pop"===i){if(0===a&&p.color!==this.player)throw new Error("Invalid move");er(l,(()=>{const e=p.popPiece();if(!e)throw new Error("Invalid move");t.push(e)}))}else{if(p.pieces.length){if(p.piece.isCapstone)throw new Error("Invalid move");if(p.piece.isStanding){if(!t[0].isCapstone||1!==l||a!==r.length-1)throw new Error("Invalid move");p.piece.isStanding=!1,p._setPiece(p.piece)}}er(l,(()=>{const e=t.pop();if(!e)throw new Error("Invalid move");p.pushPiece(e)}))}}return this.afterPly(),this.player=2===this.player?1:2,this.linenum+=Number(1===this.player),e}playPiece(e,t,r){const a=/S|wall/.test(t);t in this.pieceCounts[1]||(t="C"===t?"cap":"flat");const o=this.pieces.all[e][t][this.pieces.played[e][t].length];return o?(o.isStanding=a,this.pieces.played[e][t].push(o),r.pushPiece(o),o):null}unplayPiece(e){const t=e.popPiece();if(t){t.isStanding=!1;const e=this.pieces.played[t.color][t.type];if(t.index!==e.length-1){const r=e.pop();e.splice(t.index,1,r),[t.index,r.index]=[r.index,t.index],this.pieces.all[t.color][t.type][t.index]=t,this.pieces.all[t.color][t.type][r.index]=r}else this.pieces.played[t.color][t.type].pop();return t}return null}}},682:(e,t,r)=>{r.d(t,{Y:()=>i});var a=r(54);const o={"+":[0,1],"-":[0,-1],">":[1,0],"<":[-1,0]},i=class{constructor(e){const t=e.match(/(\d)?([CS])?([a-h])([1-8])(([<>+-])([1-8]+)?(\*)?)?([?!'"]+)?/i);if(!t)throw new Error("Invalid move");if([this.ptn,this.pieceCount,this.specialPiece,this.column,this.row,this.movement,this.direction,this.distribution,this.wallSmash,this.evalText]=t,this.specialPiece&&(this.specialPiece=this.specialPiece.toUpperCase()),this.column=this.column.toLowerCase(),this.specialPiece="F"===this.specialPiece?"":this.specialPiece,this.pieceType="C"===this.specialPiece?"cap":"flat",[this.x,this.y]=(0,a.e0)(this.column+this.row),this.movement&&!this.pieceCount&&(this.pieceCount=String(1)),this.movement&&!this.distribution&&(this.distribution=String(this.pieceCount||1)),this.squares=[this.column+this.row],this.movement){const[e,t]=o[this.direction];let r=this.x,i=this.y;this.stackDistribution=this.distribution.split("").map((o=>(r+=e,i+=t,this.squares.push((0,a.QR)(r,i)),parseInt(o,10))))}}stackTotal(){return this.distribution?this.distribution.split("").reduce(((e,t)=>e+parseInt(t,10)),0):1}isValidStackDistribution(){return!this.pieceCount&&!this.distribution||parseInt(this.pieceCount,10)===this.stackTotal()}isValid(){return this.errors=[],this.movement&&!this.isValidStackDistribution()&&this.errors.push("Invalid stack distribution"),!(this.pieceCount>1)||this.distribution&&this.direction||this.errors.push("Invalid movement: "+this.ptn),!this.errors.length}toMoveset(e=!1){if(!this.isValid())throw new Error(this.errors[0]);if(!this.movement)return[{action:e?"pop":"push",x:this.x,y:this.y,type:{C:"cap",S:"wall",F:"flat"}[this.specialPiece]||"flat"}];const t={action:e?"push":"pop",count:parseInt(this.pieceCount,10),x:this.x,y:this.y},[r,a]=o[this.direction],i=this.stackDistribution.map(((t,o)=>({action:e?"pop":"push",count:t,x:this.x+r*(o+1),y:this.y+a*(o+1)})));return this.wallSmash&&(i[i.length-1].flatten=!0),[t,...i]}toUndoMoveset(){return this.toMoveset(!0).reverse()}transform(e,[t,r]){t%=4,r%=2;let o=this.ptn,s=this.x,n=this.y,l=this.direction;return 1===t?([s,n]=[n,e-1-s],l&&(l={"+":">","-":"<",">":"-","<":"+"}[l])):2===t?(s=e-1-s,n=e-1-n,l&&(l={"+":"-","-":"+",">":"<","<":">"}[l])):3===t&&([s,n]=[e-1-n,s],l&&(l={"+":"<","-":">",">":"+","<":"-"}[l])),r&&(s=e-1-s,l&&(l={">":"<","<":">"}[l]||l)),o=o.replace((0,a.QR)(this.x,this.y),(0,a.QR)(s,n)),l&&(o=o.replace(this.direction,l)),new i(o)}}},54:(e,t,r)=>{r.d(t,{M6:()=>n,QR:()=>o,e0:()=>a});const a=e=>["abcdefgh".indexOf(e[0]),parseInt(e[1],10)-1],o=(e,t)=>"abcdefgh"[e]+(t+1),i={N:"S",S:"N",E:"W",W:"E"},s={N:"NS",S:"NS",E:"EW",W:"EW"},n=class{constructor(e,t,r){if(this.piece=null,this.color=null,this.pieces=[],this.isSelected=!1,this.isStanding=!1,this.roads=new l,this.connected=new l({disable:e=>this.roads.set(e,!1)}),this.coord=o(e,t),this.x=e,this.y=t,this.edges=new l({enable:e=>{this.isEdge=!0,this["is"+s[e]]=!0,this.isCorner=2===this.edges.length}}),this.isLight=e%2!=t%2,this.isEdge=!1,this.isCorner=!1,this.isNS=!1,this.isEW=!1,this.neighbors=new l,this.edges.setSides({N:t===r-1,S:0===t,E:e===r-1,W:0===e}),this.isEdge)this.ring=1;else{const a=(r-1)/2,o=e=>1+Math.round(a-Math.abs(e-a));this.ring=Math.min(o(e),o(t))}}_getPiece(){return this.pieces.length?this.pieces[this.pieces.length-1]:null}_setPiece(e){const t=this.color,r=this.piece&&this.isStanding;this.piece=e,e?(this.color=e.color,this.isStanding=e.isStanding):(this.color=null,this.isStanding=!1),this.color===t&&this.isStanding===r||this._updateConnected()}_updateConnected(){let e,t;Object.keys(s).forEach((r=>{this.edges[r]?this.connected[r]=Boolean(this.piece&&!this.isStanding):(e=this.neighbors[r])&&(t=Boolean(e.color===this.color&&this.piece&&!this.isStanding&&!e.isStanding),this.connected[r]=t,e.connected[i[r]]=t)}))}setRoad(e){this.connected.forEach((t=>{const r=Boolean(e&&(this.edges[t]&&e.edges[s[t]]||this.neighbors[t]&&e.squares.includes(this.neighbors[t].coord)));e&&!r||(this.roads[t]=r)}))}setStackPiece(e,t){t.square=this,this.pieces[e]=t,e===this.pieces.length-1&&this._setPiece(t)}pushPiece(e){e.square=this,this._setPiece(e),this.pieces.push(e)}pushPieces(e){e.forEach((e=>this.pushPiece(e)))}popPiece(){const e=this.pieces.pop();return e&&(e.square=null),this._setPiece(this._getPiece()),e}popPieces(e){for(;e--;)this.popPiece()}clear(){for(;this.pieces.length;)this.popPiece()}};class l{constructor(e={}){this.onEnable=e.enable||null,this.onDisable=e.disable||null,this._index={N:!1,S:!1,E:!1,W:!1},Object.keys(this._index).forEach((e=>{Object.defineProperty(this,e,{get:()=>this.get(e),set:t=>{this.set(e,t)}})})),this.length=0,this._array=[],["concat","filter","find","forEach","includes","indexOf","map","pop","push","shift","splice","unshift"].forEach((e=>this[e]=this._array[e].bind(this._array)))}setSides(e){if(e)for(const t in e)this.set(t,e[t])}get(e){return this._index[e]}set(e,t){this._index[e]!==t&&(t?(this.push("boolean"==typeof t?e:t),this._index[e]=t,this.length=this._array.length,this.onEnable&&this.onEnable(e,t)):(this.splice(this.indexOf("boolean"==typeof t?e:this._index[e]),1),this._index[e]=t,this.length=this._array.length,this.onDisable&&this.onDisable(e,t)))}}},331:(e,t,r)=>{r.d(t,{A:()=>a});const a=[{id:"classic",isBuiltIn:!0,boardStyle:"blank",boardChecker:!0,vars:{"piece-border-width":1},colors:{primary:"#8bc34a",secondary:"#607d8b",board1:"#90a4ae",board2:"#8a9faa",board3:"#78909c",player1:"#cfd8dc",player1road:"#cfd8dc",player1flat:"#cfd8dc",player1special:"#eceff1",player1border:"#546e7a",player2:"#263238",player2road:"#455a64",player2flat:"#546e7a",player2special:"#455a64",player2border:"#263238",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!1,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"aer",isBuiltIn:!0,boardStyle:"diamonds1",boardChecker:!1,vars:{"piece-border-width":1},colors:{primary:"#f0bc7d",secondary:"#cadede",board1:"#b6cdcf",board2:"#adc2c4",board3:"#b6cdcf88",player1:"#e9ecd1",player1road:"#e9ecd1",player1flat:"#dde0c7",player1special:"#f7e7b5",player1border:"#6c8481",player2:"#526e6b",player2road:"#526e6b",player2flat:"#6c8481",player2special:"#354a48",player2border:"#131c1b",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!1,secondaryDark:!1,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!1},{id:"aether",isBuiltIn:!0,boardStyle:"grid1",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#ffffffcc",secondary:"#000000",board1:"#000000",board2:"#333333",board3:"#00000000",player1:"#ffffff",player1road:"#ffffffcc",player1flat:"#ffffffcc",player1special:"#ffffffcc",player1border:"#ffffff",player2:"#333333",player2road:"#666666cc",player2flat:"#000000cc",player2special:"#000000cc",player2border:"#545454",textLight:"#ffffff",textDark:"#000000",umbra:"#000000aa"},primaryDark:!1,secondaryDark:!0,board1Dark:!0,board2Dark:!0,player1Dark:!1,player2Dark:!0},{id:"aqua",isBuiltIn:!0,boardStyle:"diamonds3",boardChecker:!1,rings:4,vars:{"piece-border-width":3,"rings-opacity":.25},colors:{primary:"#d7faee",secondary:"#00395c",board1:"#5cc4d6",board2:"#53bcdb",board3:"#00395c",player1:"#a2de30",player1road:"#5e9100",player1flat:"#9ad32e",player1special:"#beef43",player1border:"#31600e",player2:"#00bce4",player2road:"#00819e",player2flat:"#00b3d9",player2special:"#26c6e8",player2border:"#00667d",ring1:"#00000011",ring2:"#00000044",ring3:"#00000077",ring4:"#000000aa",textLight:"#c6f7e7cc",textDark:"#112430cc",umbra:"#0a233633"},primaryDark:!1,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!1},{id:"atlas",isBuiltIn:!0,boardStyle:"grid2",boardChecker:!1,fromCenter:!0,rings:4,vars:{"piece-border-width":1,"rings-opacity":.4},colors:{primary:"#baa254",secondary:"#d9cfad",board1:"#537094",board2:"#3d5878",board3:"#3d5878",player1:"#fff7e8",player1road:"#ffffff",player1flat:"#fff7e8",player1special:"#fff7e8",player1border:"#634831",player2:"#709c81",player2road:"#abd6bb",player2flat:"#709c81",player2special:"#709c81",player2border:"#112e03",ring1:"#00000011",ring2:"#00000044",ring3:"#00000077",ring4:"#000000aa",textLight:"#ffffffff",textDark:"#634831",umbra:"#453c3455"},primaryDark:!0,secondaryDark:!1,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"backlit",isBuiltIn:!0,boardStyle:"grid2",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#6a3582",secondary:"#777777cc",board1:"#888888",board2:"#777777",board3:"#999999",player1:"#eeeeee",player1road:"#ffffff",player1flat:"#999999",player1special:"#999999",player1border:"#ffffff",player2:"#444444",player2road:"#000000",player2flat:"#777777",player2special:"#777777",player2border:"#000000",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000022"},primaryDark:!0,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"bubbletron",isBuiltIn:!0,boardStyle:"diamonds3",boardChecker:!1,rings:4,vars:{"piece-border-width":2,"rings-opacity":.25},colors:{primary:"#1b47f5",secondary:"#282033",board1:"#202b59",board2:"#282033",board3:"#282033",player1:"#e055c3",player1road:"#e055c3",player1flat:"#202b59cc",player1special:"#e055c3",player1border:"#e055c3cc",player2:"#50ffe1",player2road:"#50ffe1",player2flat:"#202b59cc",player2special:"#50ffe1",player2border:"#50ffe1",ring1:"#202b5944",ring2:"#9b4fff88",ring3:"#f7be2dcc",ring4:"#c0e055ff",textLight:"#fafafacd",textDark:"#282033cc",umbra:"#28203354"},primaryDark:!0,secondaryDark:!0,player1Dark:!0,player2Dark:!1,board1Dark:!0,board2Dark:!0},{id:"discord",isBuiltIn:!0,boardStyle:"grid1",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#f0b132",secondary:"#313338",board1:"#65676b",board2:"#5b5e63",board3:"#54575c",player1:"#d6d6d6",player1road:"#d6d6d6",player1flat:"#cbcbcb",player1special:"#c1c1c1",player1border:"#363434",player2:"#080808",player2road:"#2d2d2d",player2flat:"#404040",player2special:"#333333",player2border:"#000000",textLight:"#fafafac0",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!1,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"fresh",isBuiltIn:!0,boardStyle:"diamonds1",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#37adc4",secondary:"#cccccc",board1:"#b8b8b8",board2:"#adadad",board3:"#a0a0a0",player1:"#ffffff",player1road:"#ffffff",player1flat:"#f2f2f2",player1special:"#e6e6e6",player1border:"#525252",player2:"#333333",player2road:"#525252",player2flat:"#525252",player2special:"#474747",player2border:"#f2f2f2",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!0,secondaryDark:!1,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!1},{id:"ignis",isBuiltIn:!0,boardStyle:"diamonds1",boardChecker:!0,rings:4,vars:{"piece-border-width":2,"rings-opacity":.4},colors:{primary:"#fde577",secondary:"#330721",board1:"#b81f34aa",board2:"#ab1d30aa",board3:"#c72a4088",player1:"#c72a40",player1road:"#ff6c40",player1flat:"#ff6c40",player1special:"#fde577",player1border:"#fde577",player2:"#520833",player2road:"#520833",player2flat:"#690d42",player2special:"#3d193c",player2border:"#14000cff",ring1:"#52083345",ring2:"#ff6c4087",ring3:"#fde577cc",ring4:"#fde577ff",textLight:"#fff7d1cc",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!1,secondaryDark:!0,player1Dark:!0,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"luna",isBuiltIn:!0,boardStyle:"diamonds3",boardChecker:!1,rings:4,vars:{"piece-border-width":1,"rings-opacity":.3},colors:{primary:"#dbbd60",secondary:"#000000",board1:"#888888",board2:"#666666",board3:"#00000000",player1:"#ffffff",player1road:"#cccccc",player1flat:"#cccccc",player1special:"#ffffff",player1border:"#302923",player2:"#445366",player2road:"#141f2e",player2flat:"#4f6178",player2special:"#415570",player2border:"#0f161f",ring1:"#000000ff",ring2:"#000000cc",ring3:"#302923cc",ring4:"#7a6c5dff",textLight:"#fafafa99",textDark:"#212121cd",umbra:"#00000066"},primaryDark:!1,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!0},{id:"paper",isBuiltIn:!0,boardStyle:"grid1",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#68c0e3",secondary:"#ffffff",board1:"#c8c8c8",board2:"#b8b8b8",board3:"#b8b8b8",player1:"#eeeeee",player1road:"#ffffff",player1flat:"#e8e8e8",player1special:"#ffffff",player1border:"#333333",player2:"#444444",player2road:"#606060",player2flat:"#606060",player2special:"#707070",player2border:"#000000",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000022"},primaryDark:!1,secondaryDark:!1,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!1},{id:"retro",isBuiltIn:!0,boardStyle:"grid1",boardChecker:!1,vars:{"piece-border-width":2},colors:{primary:"#a87419",secondary:"#4d4d4d",board1:"#858585cc",board2:"#686868",board3:"#686868",player1:"#d1d1d1",player1road:"#d1d1d1",player1flat:"#c7c7c7",player1special:"#bcbcbc",player1border:"#424242",player2:"#212121",player2road:"#424242",player2flat:"#424242",player2special:"#373737",player2border:"#c7c7c7",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!0,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"stealth",isBuiltIn:!0,boardStyle:"blank",boardChecker:!0,vars:{"piece-border-width":1},colors:{primary:"#800000",secondary:"#111111",board1:"#585858",board2:"#515151",board3:"#303030",player1:"#ababab",player1road:"#ababab",player1flat:"#a2a2a2",player1special:"#b3b3b3",player1border:"#262626",player2:"#000000",player2road:"#262626",player2flat:"#363636",player2special:"#1a1a1a",player2border:"#000000",textLight:"#fafafa99",textDark:"#212121cd",umbra:"#00000066"},primaryDark:!0,secondaryDark:!0,board1Dark:!0,board2Dark:!0,player1Dark:!1,player2Dark:!0},{id:"terra",isBuiltIn:!0,boardStyle:"grid3",boardChecker:!0,vars:{"piece-border-width":1},colors:{primary:"#edcc55",secondary:"#50628c",board1:"#95ad66",board2:"#88a356",board3:"#877863",player1:"#ddf0dd",player1road:"#ddf0dd",player1flat:"#d2e4d2",player1special:"#e1f2e1",player1border:"#545e54",player2:"#364136",player2road:"#545e54",player2flat:"#545e54",player2special:"#363d36",player2border:"#101210",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000033"},primaryDark:!1,secondaryDark:!0,player1Dark:!1,player2Dark:!0,board1Dark:!0,board2Dark:!0},{id:"zen",isBuiltIn:!0,boardStyle:"grid3",boardChecker:!1,vars:{"piece-border-width":1},colors:{primary:"#6ca130",secondary:"#dddddd",board1:"#decb9e",board2:"#d1bc8a",board3:"#d1bc8a",player1:"#ffffff",player1road:"#ffffff",player1flat:"#f2f2f2",player1special:"#ffffff",player1border:"#c7c7c7",player2:"#444444",player2road:"#606060",player2flat:"#606060",player2special:"#454444",player2border:"#171717",textLight:"#fafafacd",textDark:"#212121cd",umbra:"#00000055"},primaryDark:!0,secondaryDark:!1,player1Dark:!1,player2Dark:!0,board1Dark:!1,board2Dark:!1}]}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var _Board_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(246),_Ply_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(682),_themes_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(331),lodash_es__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(703),lodash_es__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(916),lodash_es__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(49),lodash_es__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(879),lodash_es__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(666);const pieceSizes={xs:12,sm:24,md:48,lg:96,xl:192},textSizes={xs:.1875,sm:.21875,md:.25,lg:.3,xl:.4},defaults={delay:1e3,imageSize:"md",textSize:"md",axisLabels:!0,turnIndicator:!0,flatCounts:!0,stackCounts:!0,komi:0,moveNumber:!0,evalText:!0,opening:"swap",ply:"",tps:"",plies:[],showRoads:!0,unplayedPieces:!0,padding:!0,bgAlpha:1,transparent:!1,hlSquares:!0,highlighter:null,transform:[0,0],plyIsDone:!0,font:"sans-serif"};function sanitizeOptions(options){for(const key in defaults)if(options.hasOwnProperty(key))if("highlighter"===key&&(0,lodash_es__WEBPACK_IMPORTED_MODULE_3__.A)(options[key]))try{options[key]=JSON.parse(options[key])}catch(e){throw console.log(e),new Error("Invalid highlighter")}else if("moveNumber"!==key||(0,lodash_es__WEBPACK_IMPORTED_MODULE_4__.A)(options[key]))if("transform"===key){if((0,lodash_es__WEBPACK_IMPORTED_MODULE_3__.A)(options[key]))try{options[key]=eval(options[key])}catch(e){options[key]=defaults[key]}(0,lodash_es__WEBPACK_IMPORTED_MODULE_5__.A)(options[key])?(options[key]=options[key].slice(0,2).map((e=>parseInt(e,10))),options[key].some((e=>isNaN(e)))&&(options[key]=defaults[key])):options[key]=defaults[key]}else"plies"===key?(0,lodash_es__WEBPACK_IMPORTED_MODULE_3__.A)(options[key])&&(options[key]=options[key].split(/[\s,]+/)):(0,lodash_es__WEBPACK_IMPORTED_MODULE_4__.A)(defaults[key])?options[key]=!1!==options[key]&&"false"!==options[key]:(0,lodash_es__WEBPACK_IMPORTED_MODULE_6__.A)(defaults[key])&&(options[key]=Number(options[key]));else{const e=parseInt(options[key],10);isNaN(e)?options[key]="false"!==options[key]:options[key]=e}else options[key]=defaults[key];return options.size&&(options.size=Number(options.size)),options.tps&&1===options.tps.length&&(options.tps=Number(options.tps)),options}const parseTheme=function(e){if(!e||!(0,lodash_es__WEBPACK_IMPORTED_MODULE_3__.A)(e))return e||_themes_js__WEBPACK_IMPORTED_MODULE_2__.A[0];if("{"!==e[0]){if(!(e=_themes_js__WEBPACK_IMPORTED_MODULE_2__.A.find((t=>t.id===e))))throw new Error("Invalid theme ID");return e}try{const t=JSON.parse(e);if(!t.colors)throw new Error("Missing theme colors");const r=Object.keys(t.colors);if(Object.keys(_themes_js__WEBPACK_IMPORTED_MODULE_2__.A[0].colors).some((e=>!r.includes(e))))throw new Error("Missing theme colors");if(e.rings>0){if(e.rings>4)throw new Error("Rings must not exceed 4");for(let t=1;t<=e.rings;t++)if(!e.colors[`ring${t}`])throw new Error(`Expected ${e.rings} ring(s) but found ${t-1}`)}return t}catch(e){throw console.log(e),new Error("Invalid theme")}},TPStoCanvas=function(e={}){sanitizeOptions(e);const t=parseTheme(e.theme),r=new _Board_js__WEBPACK_IMPORTED_MODULE_0__.bW(e);if(!r||r.errors&&r.errors.length)throw new Error(r.errors[0]);let a=[],o="";if(e.plies&&e.plies.length){const t=e.plies.map((e=>r.doPly(e)));let i=(0,lodash_es__WEBPACK_IMPORTED_MODULE_7__.A)(t);a=i.squares,o=i.evalText||"",e.plyIsDone=!0}else if(e.ply){const t=r.doPly(e.ply);a=t.squares,o=t.evalText||"",e.plyIsDone=!0}else if(e.hl){let t=new _Ply_js__WEBPACK_IMPORTED_MODULE_1__.Y(e.hl);t=t.transform(r.size,e.transform),a=t.squares}const i=Math.round(5*pieceSizes[e.imageSize]/r.size),s=2*i,n=Math.round(.3333*s),l=Math.round(.05*s),c=Math.round(.07*s),p=Math.round(.15*s),d=Math.round(.1875*s),f={N:[(s-n)/2,0],S:[(s-n)/2,s-n],E:[s-n,(s-n)/2],W:[0,(s-n)/2]},h=Math.round(t.vars["piece-border-width"]*s*.013),u=h/2+Math.round(.02*s),y=h+Math.round(.03*s),b=s*textSizes[e.textSize]*r.size/5,_=Math.min(.18*s,b),g=e.padding?Math.round(.5*b):0,m=e.turnIndicator?Math.round(2*b):0,v=e.turnIndicator?Math.round(.5*b):0,k=v+m,w=e.axisLabels?Math.round(1.5*b):0,D=Math.round(m/4),x=Math.round(s/10),A=s*r.size,E=e.unplayedPieces?Math.round(1.75*s):0,S=E+w+A+2*g,j=k+w+A+2*g;e.transparent&&(e.bgAlpha=0);const O=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");O.width=S,O.height=j;const P=O.getContext("2d");P.font=`${b}px ${e.font}`,P.globalAlpha=e.bgAlpha,P.fillStyle=t.colors.secondary,P.fillRect(0,0,S,j),P.globalAlpha=1;const C=r.flats.concat(),M=e.komi;if(e.turnIndicator){const a=C[0]+C[1],i=Math.round(Math.min(A-s,Math.max(s,(e.flatCounts&&a?C[0]/a:.5)*A))),n=Math.round(A-i),l=e.flatCounts?Math.round(M<0?i*(-M/C[0]):n*(M/C[1])):0;if(e.flatCounts?M<0?C[0]=C[0]+M+" +"+(-M).toString().replace(/0?\.5/,"½"):M>0&&(C[1]=C[1]-M+" +"+M.toString().replace(/0?\.5/,"½")):(C[0]="",C[1]="",M<0?C[0]="+"+(-M).toString().replace(/0?\.5/,"½"):M>0&&(C[1]="+"+M.toString().replace(/0?\.5/,"½"))),P.fillStyle=t.colors.player1,roundRect(P,g+w,g,i,m,{tl:D}),P.fill(),P.fillStyle=t.colors.player2,roundRect(P,g+w+i,g,n,m,{tr:D}),P.fill(),l){const e=M<0?i:n,r=M<0?t.player1Dark:t.player2Dark;P.fillStyle=r?"#fff":"#000",P.globalAlpha=.13,l>=e?(roundRect(P,g+w+(M>0)*i,g,e,m,{[M<0?"tl":"tr"]:D}),P.fill()):P.fillRect(g+w+i-(M<0)*l,g,l,m),P.globalAlpha=1}if(P.fillStyle=t.player1Dark?t.colors.textLight:t.colors.textDark,P.textBaseline="middle",e.player1){const t=P.measureText(C[0]).width,r=limitText(P,e.player1,i-t-1.2*b);P.textAlign="start",P.fillText(r,g+w+b/2,g+m/2)}if(""!==C[0]&&(P.textAlign="end",C[0]=String(C[0]).split(" "),P.fillText(C[0][0],g+w+i-b/2,g+m/2),C[0][1]&&(C[0][1]=C[0][1].substring(1)+"+",P.globalAlpha=.5,P.fillText(C[0][1],g+w+i-b/2-P.measureText(C[0][0]+" ").width,g+m/2),P.globalAlpha=1)),P.fillStyle=t.player2Dark?t.colors.textLight:t.colors.textDark,e.player2){const t=P.measureText(C[1]).width,r=limitText(P,e.player2,n-t-1.2*b);P.textAlign="end",P.fillText(r,g+w+A-b/2,g+m/2)}e.flatCounts&&(P.textAlign="start",C[1]=String(C[1]).split(" "),P.fillText(C[1][0],g+w+i+b/2,g+m/2),C[1][1]&&(P.globalAlpha=.5,P.fillText(C[1][1],g+w+i+b/2+P.measureText(C[1][0]+" ").width,g+m/2),P.globalAlpha=1)),r.isGameEnd||(P.fillStyle=t.colors.primary,P.fillRect(g+w+(1===r.player?0:A/2),g+m,A/2,v));let c=0;if(e.moveNumber&&e.unplayedPieces){let a;"number"==typeof e.moveNumber?a=e.moveNumber:(a=r.linenum,a>1&&1===r.player&&(a-=1)),a+=".",P.save(),P.textBaseline="middle",P.textAlign="center",P.shadowOffsetX=0,P.shadowOffsetY=.05*b,P.shadowBlur=.1*b,P.shadowColor=t.secondaryDark||e.bgAlpha<.5?t.colors.textDark:t.colors.textLight,P.fillStyle=t.secondaryDark||e.bgAlpha<.5?t.colors.textLight:t.colors.textDark,P.fillText(a,g+w+A+E/2,g+m/2);let{width:o}=P.measureText(a);c=o,P.restore()}e.evalText&&e.unplayedPieces&&o&&(c&&(o=" "+o),P.save(),P.textBaseline="middle",P.textAlign=e.moveNumber?"left":"center",P.shadowOffsetX=0,P.shadowOffsetY=.05*b,P.shadowBlur=.1*b,P.shadowColor=t.secondaryDark||e.bgAlpha<.5?t.colors.textDark:t.colors.textLight,P.fillStyle=t.colors.primary,P.font=`bold ${b}px ${e.font}`,P.fillText(o,g+w+A+E/2+c/2,g+m/2),P.restore())}if(e.axisLabels){const a="abcdefgh".substring(0,r.size).split(""),o="12345678".substring(0,r.size).split(""),i=e.transform[0]%2?a.concat():o.concat();1!==e.transform[0]&&2!==e.transform[0]||i.reverse();const n=e.transform[0]%2?o.concat():a.concat();(e.transform[1]?0===e.transform[0]||1===e.transform[0]:2===e.transform[0]||3===e.transform[0])&&n.reverse(),P.save(),P.shadowOffsetX=0,P.shadowOffsetY=.05*b,P.shadowBlur=.1*b,P.shadowColor=t.secondaryDark||e.bgAlpha<.5?t.colors.textDark:t.colors.textLight,P.fillStyle=t.secondaryDark||e.bgAlpha<.5?t.colors.textLight:t.colors.textDark;for(let e=0;e<r.size;e++){const t=[n[e],i[e]];P.textBaseline=g?"middle":"bottom",P.textAlign="center",P.fillText(t[0],g+w+s*e+s/2,g+k+A+(g?(w+g)/2:w)),P.textBaseline="middle",P.textAlign=g?"center":"left",P.fillText(t[1],g?(w+g)/2:0,g+k+s*(r.size-e-1)+s/2)}P.restore()}let I=0,T=0;switch(t.boardStyle){case"diamonds1":I=.1*s;break;case"diamonds2":I=.3*s;break;case"diamonds3":I=.5*s;break;case"grid1":T=.01*s;break;case"grid2":T=.03*s,I=.05*s;break;case"grid3":T=.06*s,I=.15*s}const q=()=>{const e=s/2;I>=e?(P.beginPath(),P.arc(e,e,e,0,2*Math.PI),P.closePath()):roundRect(P,T,T,s-2*T,s-2*T,I),P.fill()},N=o=>{const i=t.boardChecker&&!o.isLight;if(P.save(),P.translate(g+w+o.x*s,g+k+(r.size-o.y-1)*s),t.boardStyle&&"blank"!==t.boardStyle?(P.fillStyle=t.colors["board"+(i?1:2)],P.fillRect(0,0,s,s),P.fillStyle=t.colors["board"+(i?2:1)],q()):(P.fillStyle=t.colors["board"+(i?2:1)],P.fillRect(0,0,s,s)),t.rings){let e=o.ring;t.fromCenter&&(e=Math.round(r.size/2)-e+1),e<=t.rings&&(P.fillStyle=t.colors["ring"+e],P.globalAlpha=t.vars["rings-opacity"],q(),P.globalAlpha=1)}if(e.highlighter&&o.coord in e.highlighter)P.fillStyle=withAlpha(e.highlighter[o.coord],.75),q();else if(e.hlSquares&&a.includes(o.coord)){const r=[.4,.75];e.plyIsDone||r.reverse(),P.fillStyle=withAlpha(t.colors.primary,a.length>1&&o.coord===a[0]?r[0]:r[1]),q()}if(e.showRoads&&o.connected.length?(o.connected.forEach((e=>{const r=f[e];P.fillStyle=withAlpha(t.colors[`player${o.color}road`],o.roads[e]?.8:.2),P.fillRect(r[0],r[1],n,n)})),P.fillStyle=withAlpha(t.colors[`player${o.color}road`],o.roads.length?.8:.2),P.fillRect((s-n)/2,(s-n)/2,n,n)):o.roads.length&&(P.fillStyle=withAlpha(t.colors[`player${o.color}road`],.35),q()),o.piece){if(r.isGameEndFlats&&!o.piece.typeCode()&&(P.fillStyle=withAlpha(t.colors[`player${o.color}road`],.4),q()),e.stackCounts&&o.pieces.length>1){P.save(),P.font=`${_}px ${e.font}`;let r=t.board2Dark;P.fillStyle=t.colors.board2,a.includes(o.coord)?(r=t.primaryDark,P.fillStyle=t.colors.primary):i&&(r=t.board1Dark,P.fillStyle=t.colors.board1);const n=1.5*_/2;P.beginPath(),P.arc(s-n,s-n,n,0,2*Math.PI),P.closePath(),P.fill(),P.fillStyle=r?t.colors.textLight:t.colors.textDark,P.textBaseline="middle",P.textAlign="center",P.fillText(o.pieces.length,s-n,s-.9*n),P.restore()}o.pieces.forEach(z)}P.restore()},z=a=>{P.save();const o=a.square?a.square.pieces:null,n=s/2;P.translate(n,n);let f=0;const b=a.z(),_=o&&o.length>r.size,g=_&&b<o.length-r.size;if(a.square){f-=c*b,_&&!g&&(f+=c*(o.length-r.size)),a.isStanding&&o.length>1&&(f+=c);const e=Math.max(0,o.length-10-r.size);if(g){if(b<e)return void P.restore();f+=c*e}}else{const t="swap"!==e.opening||0!==a.index||a.isCapstone?a.color:1===a.color?2:1,o=r.pieceCounts[t].cap,i=r.pieceCounts[t].total;f=r.size-1,a.isCapstone?f*=i-a.index-1:f*=i-a.index-o-1,f*=-s/(i-1)}f=Math.round(f),a.isCapstone?(P.fillStyle=t.colors[`player${a.color}special`],P.beginPath(),P.arc(0,f,i/2,0,2*Math.PI)):a.isStanding?(P.fillStyle=t.colors[`player${a.color}special`],P.translate(0,f),P.rotate((1===a.color?-45:45)*Math.PI/180),roundRect(P,Math.round(-d/2),Math.round(-i/2),d,i,l)):(P.fillStyle=t.colors[`player${a.color}flat`],g?roundRect(P,Math.round(i/2),Math.round(f+i/2-c),p,c,l/2):roundRect(P,Math.round(-i/2),Math.round(f-i/2),i,i,l)),P.save(),P.shadowBlur=y,P.shadowOffsetY=u,P.shadowColor=t.colors.umbra,P.fill(),P.restore(),t.vars["piece-border-width"]>0&&(P.strokeStyle=t.colors[`player${a.color}border`],P.lineWidth=h,P.stroke()),P.restore()};return r.squares.concat().reverse().forEach((e=>e.forEach(N))),e.unplayedPieces&&(P.fillStyle=t.colors.board3,roundRect(P,w+g+A,k+g,E,A,{tr:x,br:x}),P.fill(),[1,2].forEach((t=>{P.save(),P.translate(g+w+A+(2===t)*s*.75,g+k+A-s),["flat","cap"].forEach((a=>{const o=r.pieceCounts[t][a],i=r.pieces.played[t][a].length,s=o-i,n=r.pieces.all[t][a].slice(o-s);"flat"===a&&"swap"===e.opening&&(1===t?r.pieces.played[2][a].length?i||n.shift():n[0]=r.pieces.all[2][a][0]:r.pieces.played[1][a].length||(r.pieces.played[2][a].length?n.unshift(r.pieces.all[1][a][0]):n[0]=r.pieces.all[1][a][0])),n.reverse().forEach(z)})),P.restore()}))),O.ctx=P,O.isGameEnd=r.isGameEnd,O.linenum=r.linenum,O.player=r.player,O.tps=r.getTPS(),O.id=r.result||O.tps,O};function withAlpha(e,t){return e.substring(0,7)+Math.round(256*t).toString(16)}function limitText(e,t,r){if(r<=0)return"";if(r>=e.measureText(t).width)return t;do{t=t.substring(0,t.length-1)}while(t.length&&e.measureText(t+"…").width>=r);return t+"…"}function roundRect(e,t,r,a,o,i){const s={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(const e in i)s[e]=i[e];else for(const e in s)s[e]=i;e.beginPath(),e.moveTo(t+s.tl,r),e.lineTo(t+a-s.tr,r),e.quadraticCurveTo(t+a,r,t+a,r+s.tr),e.lineTo(t+a,r+o-s.br),e.quadraticCurveTo(t+a,r+o,t+a-s.br,r+o),e.lineTo(t+s.bl,r+o),e.quadraticCurveTo(t,r+o,t,r+o-s.bl),e.lineTo(t,r+s.tl),e.quadraticCurveTo(t,r,t+s.tl,r),e.closePath()}const svg=document.firstChild,viewY=+svg.attributes.viewBox.value.split(" ")[1];let ply;for(let e of svg.children)if("circle"===e.nodeName){const t=e.attributes.tps.value,r={...pngOptions,tps:t};ply&&(r.hl=ply);const a=document.createElementNS("http://www.w3.org/2000/svg","image"),o=e.attributes.cx.value-popupWidth/2;let i=+e.attributes.cy.value;i<viewY+popupHeight?i+=+e.attributes.r.value:i-=popupHeight+ +e.attributes.r.value,a.setAttributeNS(null,"width",popupWidth),a.setAttributeNS(null,"height",popupHeight),a.setAttributeNS(null,"x",o),a.setAttributeNS(null,"y",i),a.setAttributeNS(null,"style","pointer-events: none");let s=null;e.addEventListener("mouseover",(()=>{s&&clearTimeout(s),a.attributes.href||a.setAttributeNS(null,"href",TPStoCanvas(r).toDataURL()),svg.appendChild(e),svg.appendChild(a),e.setAttributeNS(null,"style","opacity: 1; fill: #fff;")})),e.addEventListener("mouseout",(()=>{s=setTimeout((()=>{svg.removeChild(a),e.setAttributeNS(null,"style",""),s=null}),popupHideDelay)}))}else"line"===e.nodeName&&(ply=e.attributes.action.value,e.setAttributeNS(null,"style","pointer-events: none"))})()})();
// ]]>